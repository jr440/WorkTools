<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Duct Calculator - Complete</title>
    <style>
        :root {
            /* Light Theme - Clean Professional */
            --bg-primary: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            --bg-secondary: #ffffff;
            --bg-tertiary: #f8fafc;
            --bg-card: #ffffff;
            --text-primary: #1a202c;
            --text-secondary: #4a5568;
            --text-muted: #718096;
            --border-color: #e2e8f0;
            --accent-color: #4299e1;
            --accent-secondary: #3182ce;
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.12);
            --shadow-md: 0 4px 6px rgba(0,0,0,0.07);
            --shadow-lg: 0 10px 15px rgba(0,0,0,0.1);
            --success-bg: #f0fff4;
            --success-border: #38a169;
            --success-text: #2f855a;
            --error-bg: #fed7d7;
            --error-border: #e53e3e;
            --error-text: #c53030;
            --danger-bg: #fff5f5;
            --danger-text: #c53030;
            --danger-border: #fed7d7;
            --neon-glow: 0 0 5px #fff, 0 0 10px #fff, 0 0 15px var(--accent-color), 0 0 20px var(--accent-color), 0 0 25px var(--accent-color), 0 0 30px var(--accent-color), 0 0 35px var(--accent-color);
        }
        [data-theme="dark"] {
            /* Dark Theme - Modern Professional */
            --bg-primary: linear-gradient(135deg, #1a202c 0%, #2d3748 100%);
            --bg-secondary: #1a202c;
            --bg-tertiary: #2d3748;
            --bg-card: #2d3748;
            --text-primary: #f7fafc;
            --text-secondary: #e2e8f0;
            --text-muted: #a0aec0;
            --border-color: #4a5568;
            --accent-color: #63b3ed;
            --accent-secondary: #4299e1;
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.3);
            --shadow-md: 0 4px 6px rgba(0,0,0,0.3);
            --shadow-lg: 0 10px 15px rgba(0,0,0,0.4);
            --success-bg: #1a202c;
            --success-border: #48bb78;
            --success-text: #68d391;
            --error-bg: #1a202c;
            --error-border: #f56565;
            --error-text: #fc8181;
            --danger-bg: #2d3748;
            --danger-text: #fc8181;
            --danger-border: #4a5568;
        }

        /* "Acid Trip" Cyberpunk Theme */
        [data-theme="cyberpunk"] {
            --bg-primary: linear-gradient(270deg, #ff00c8, #f7ff00, #6fff00, #00d7ff, #ff00c8);
            --bg-secondary: rgba(15, 0, 25, 0.9);
            --bg-tertiary: #1d002c;
            --bg-card: rgba(15, 0, 25, 0.9);
            --text-primary: #6fff00;
            --text-secondary: #ff00f7;
            --text-muted: #00d7ff;
            --border-color: rgba(102, 255, 0, 0.6);
            --accent-color: #ff00c8;
            --accent-secondary: #f7ff00;
            --success-bg: rgba(0, 64, 0, 0.9);
            --success-border: #00ff88;
            --success-text: #00ff9d;
            --error-bg: rgba(64, 0, 0, 0.9);
            --error-border: #ff0055;
            --error-text: #ff0066;
            --danger-bg: rgba(64, 0, 0, 0.9);
            --danger-text: #ff0066;
            --danger-border: #ff0055;
            --shadow-sm: 0 0 4px var(--accent-color), 0 0 8px var(--accent-secondary);
            --shadow-md: 0 0 10px rgba(255, 0, 200, 0.5), 0 0 15px rgba(102, 255, 0, 0.4);
            --shadow-lg: 0 0 15px rgba(255, 0, 200, 0.6), 0 0 25px rgba(247, 255, 0, 0.4), inset 0 0 10px rgba(102, 255, 0, 0.5);
            --neon-glow: 0 0 5px #fff, 0 0 10px #fff, 0 0 15px var(--accent-color), 0 0 20px var(--accent-color), 0 0 25px var(--accent-color), 0 0 30px var(--accent-color), 0 0 35px var(--accent-color);
        }

        /* Add animation for the cyberpunk theme */
        [data-theme="cyberpunk"] body {
            background-size: 400% 400%;
            animation: acid-trip-bg 15s ease infinite;
        }

        @keyframes acid-trip-bg {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-primary);
            min-height: 100vh;
            color: var(--text-primary);
            line-height: 1.6;
            transition: all 0.3s ease;
        }

        .theme-selector {
            position: fixed;
            top: 24px;
            right: 24px;
            z-index: 1000;
            display: flex;
            gap: 8px;
            background: var(--bg-card);
            padding: 8px;
            border-radius: 12px;
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--border-color);
        }
        .theme-btn {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            border: 2px solid transparent;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .theme-btn.active {
            border-color: var(--accent-color);
            transform: scale(1.1);
        }
        .theme-light { background: linear-gradient(135deg, #f5f7fa, #c3cfe2); }
        .theme-dark { background: linear-gradient(135deg, #1a202c, #2d3748); }
        .theme-cyberpunk { background: linear-gradient(135deg, #ff00c8, #6fff00); }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 24px;
        }
        .header {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 32px;
            text-align: center;
            margin-bottom: 24px;
            box-shadow: var(--shadow-md);
            border: 1px solid var(--border-color);
        }
        .header h1 {
            font-size: 3.0rem;
            font-weight: 400;
            margin-bottom: 8px;
            background: linear-gradient(135deg, var(--accent-color), var(--accent-secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .header p {
            font-size: 1rem; /* Changed to a normal readable size */
            color: var(--text-muted);
        }
        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
            margin-bottom: 24px;
        }
        .card {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 24px;
            box-shadow: var(--shadow-md);
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
        }
        .card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        [data-theme="cyberpunk"] .card {
            border: 1px solid var(--border-color);
            box-shadow: var(--neon-glow);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .card-title {
            font-size: 1.75rem;
            font-weight: 600;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 8px;
            color: var(--text-primary);
        }
        .tabs {
            display: flex;
            margin-bottom: 24px;
            background: var(--bg-tertiary);
            border-radius: 12px;
            padding: 4px;
        }
        .tab {
            flex: 1;
            padding: 12px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            text-align: center;
            color: var(--text-muted);
            transition: all 0.2s ease;
            font-size: 1.5rem;
        }
        .tab.active {
            background: var(--accent-color);
            color: white;
            box-shadow: var(--shadow-sm);
        }
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }
        .form-row.single {
            grid-template-columns: 1fr;
        }

        .form-row.triple {
            grid-template-columns: 1fr 1fr 1fr;
        }
        label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: var(--text-secondary);
            font-size: 1rem;
        }
        input, select {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 1.0rem;
            background: var(--bg-secondary);
            color: var(--text-primary);
            transition: all 0.2s ease;
        }
        input:focus, select:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.1);
        }
        .btn {
            background: linear-gradient(135deg, var(--accent-color), var(--accent-secondary));
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 1.0rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            margin-right: 8px;
        }
        .btn:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }
        [data-theme="cyberpunk"] .btn {
            text-shadow: 0 0 8px currentColor;
            position: relative;
            overflow: hidden;
        }
        [data-theme="cyberpunk"] .btn::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(
                45deg,
                transparent,
                rgba(255, 0, 200, 0.4),
                transparent
            );
            transform: rotate(45deg);
            animation: scan 3s infinite linear;
        }
        @keyframes scan {
            0% { transform: translateY(-200%) rotate(45deg); }
            100% { transform: translateY(200%) rotate(45deg); }
        }
        .btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-secondary);
            border: 1px solid var(--border-color);
        }
        .btn-sm {
            padding: 6px 12px;
            font-size: 0.7rem;
        }
        .btn-danger {
            background: var(--danger-bg);
            color: var(--danger-text);
            border: 1px solid var(--danger-border);
        }
        .constraint-group {
            background: var(--bg-tertiary);
            padding: 16px;
            border-radius: 12px;
            margin-top: 16px;
            border: 1px solid var(--border-color);
        }
        .constraint-title {
            font-weight: 600;
            margin-bottom: 12px;
            color: var(--text-primary);
            font-size: 1.0rem;
        }
        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
        }
        .result-card {
            background: var(--bg-secondary);
            padding: 16px;
            border-radius: 12px;
            border-left: 4px solid var(--accent-color);
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
            transition: all 0.2s ease;
        }
        .result-card:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }
        /* Add these CSS classes for result card status colors */
        .result-card.status-optimal {
            border-left: 4px solid var(--success-border);
        }
        .result-card.status-warning {
            border-left: 4px solid var(--accent-secondary);
        }
        .result-card.status-critical {
            border-left: 4px solid var(--error-border);
        }

        .result-label {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }

        .result-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 2px;
        }
        .result-unit {
            font-size: 1.0rem;
            color: var(--text-muted);
        }

        .status-message {
            position: fixed;
            top: 24px;
            left: 50%;
            transform: translateX(-50%);
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 500;
            z-index: 1001;
            opacity: 0;
            transition: all 0.3s ease;
        }
        .status-message.show {
            opacity: 1;
        }
        .status-success {
            background: var(--success-bg);
            color: var(--success-text);
            border: 1px solid var(--success-border);
        }
        .status-error {
            background: var(--error-bg);
            color: var(--error-text);
            border: 1px solid var(--error-border);
        }

        .sizing-method-info {
            background: var(--bg-tertiary);
            padding: 12px;
            border-radius: 8px;
            margin-top: 8px;
            font-size: 1.0;
            color: var(--text-muted);
            border-left: 3px solid var(--accent-color);
        }
        .empty-state {
            text-align: center;
            color: var(--text-muted);
            padding: 40px 20px;
            font-size: 1rem;
        }
        .empty-state-icon {
            font-size: 3rem;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        /* Toggle switch styles */
        .toggle-switch {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 12px;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 48px;
            height: 24px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--bg-tertiary);
            transition: .4s;
            border-radius: 24px;
            border: 1px solid var(--border-color);
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 2px;
            background-color: var(--text-muted);
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: var(--accent-color);
        }

        input:checked + .slider:before {
            transform: translateX(22px);
            background-color: white;
        }

        .toggle-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        /* History Panel Styles */
        .history-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid var(--border-color);
            gap: 16px;
        }
        .history-item:last-child {
            border-bottom: none;
        }
        .history-details {
            display: flex;
            flex-wrap: wrap;
            gap: 8px 16px;
            font-size: 0.8rem;
        }
        .history-detail {
            color: var(--text-secondary);
        }
        .history-detail strong {
            color: var(--text-primary);
        }
        .history-timestamp {
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-top: 4px;
        }

        @media (max-width: 768px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
            .form-row {
                grid-template-columns: 1fr;
            }
            .tabs {
                flex-direction: column;
            }
            .tab {
                margin-bottom: 4px;
            }
            .theme-selector {
                top: 12px;
                right: 12px;
            }
            .history-item {
                flex-direction: column;
                align-items: flex-start;
            }
        }
    </style>
</head>
<body data-theme="light">
    <div class="theme-selector">
        <div class="theme-btn theme-light active" onclick="setTheme('light')" title="Light Theme"></div>
        <div class="theme-btn theme-dark" onclick="setTheme('dark')" title="Dark Theme"></div>
        <div class="theme-btn theme-cyberpunk" onclick="setTheme('cyberpunk')" title="Cyberpunk Theme"></div>
    </div>

    <div class="status-message" id="statusMessage"></div>

    <div class="container">
        <div class="header">
            <h1>JR's Duct Calculator</h1>
            <p>My ductulator because sometimes it's quicker to build your own tool than find a decent one online.
                This calculator was created out of necessity and boredom and shared because good tools
                should be accessible and free.

                Note: Double-check all calculations and verify against local codes. Use at your
                own discretion. Feel free to share - no ads, no tracking, just a tool.

                Email - jesse@obandco.com.au if you have any suggestions for additional features</p>
        </div>

        <div class="main-grid">
            <div class="card">
                <div class="card-title">
                    <span>📊 Duct Sizing Parameters</span>
                </div>

                <div class="constraint-group">
                    <div class="constraint-title">Global Sizing Constraints</div>
                    <div class="form-row">
                        <div>
                            <label>Max Aspect Ratio</label>
                            <input type="number" id="global-aspect-ratio" value="1.5" step="0.1">
                        </div>
                        <div>
                            <label>Sizing Step (mm)</label>
                            <select id="global-step-size">
                                <option value="25">25</option>
                                <option value="50" selected>50</option>
                                <option value="100">100</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="tabs" style="margin-top: 24px;">
                    <div class="tab active" onclick="switchTab('single')">Single Calc</div>
                    <div class="tab" onclick="switchTab('velocity')">Velocity Size</div>
                    <div class="tab" onclick="switchTab('pressure')">Pressure Size</div>
                    <div class="tab" onclick="switchTab('combined')">Combined Size</div>
                </div>

                <div id="single-tab" class="tab-content active">
                    <div class="form-group">
                        <div class="form-row">
                            <div>
                                <label>Duct Shape</label>
                                <select id="single-shape" onchange="toggleShapeInputs('single')">
                                    <option value="rectangular">Rectangular</option>
                                    <option value="circular">Circular</option>
                                </select>
                            </div>
                            <div>
                                <label>Air Flow Rate (L/s)</label>
                                <input type="number" id="single-flow" value="500" step="0.1">
                            </div>
                        </div>
                    </div>

                    <div id="single-rectangular-inputs">
                        <div class="form-group">
                            <div class="form-row">
                                <div>
                                    <label>Width (mm)</label>
                                    <input type="number" id="single-width" value="300" step="1">
                                </div>
                                <div>
                                    <label>Height (mm)</label>
                                    <input type="number" id="single-height" value="200" step="1">
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="single-circular-inputs" style="display: none;">
                        <div class="form-group">
                            <div class="form-row single">
                                <div>
                                    <label>Diameter (mm)</label>
                                    <input type="number" id="single-diameter" value="250" step="1">
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <button class="btn" onclick="calculateSingle()">Calculate</button>
                        <button class="btn btn-secondary" onclick="clearSingleForm()">Clear</button>
                    </div>
                </div>

                <div id="velocity-tab" class="tab-content">
                    <div class="form-group">
                        <div class="form-row">
                            <div>
                                <label>Duct Shape</label>
                                <select id="velocity-shape" onchange="toggleShapeInputs('velocity')">
                                    <option value="rectangular">Rectangular</option>
                                    <option value="circular">Circular</option>
                                </select>
                            </div>
                            <div>
                                <label>Air Flow Rate (L/s)</label>
                                <input type="number" id="velocity-flow" value="500" step="0.1">
                            </div>
                        </div>
                    </div>

                    <div class="constraint-group">
                        <div class="constraint-title">Velocity Constraints</div>
                        <div class="form-row">
                            <div>
                                <label>Max Velocity (m/s)</label>
                                <input type="number" id="velocity-max" value="12" step="0.1">
                            </div>
                            <div>
                                <label>Preferred Velocity (m/s)</label>
                                <input type="number" id="velocity-preferred" value="6" step="0.1">
                            </div>
                        </div>
                    </div>

                    <div id="velocity-rectangular-constraints">
                        <div class="constraint-group">
                            <div class="constraint-title">Size Constraints (Rectangular)</div>
                            <div class="form-row">
                                <div>
                                    <label>Min Width (mm)</label>
                                    <input type="number" id="velocity-min-width" value="250" step="50">
                                </div>
                                <div>
                                    <label>Max Width (mm)</label>
                                    <input type="number" id="velocity-max-width" value="1000" step="50">
                                </div>
                            </div>
                            <div class="form-row">
                                <div>
                                    <label>Min Height (mm)</label>
                                    <input type="number" id="velocity-min-height" value="250" step="50">
                                </div>
                                <div>
                                    <label>Max Height (mm)</label>
                                    <input type="number" id="velocity-max-height" value="800" step="50">
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="velocity-circular-constraints" style="display: none;">
                        <div class="constraint-group">
                            <div class="constraint-title">Size Constraints (Circular)</div>
                            <div class="form-row">
                                <div>
                                    <label>Min Diameter (mm)</label>
                                    <input type="number" id="velocity-min-diameter" value="200" step="50">
                                </div>
                                <div>
                                    <label>Max Diameter (mm)</label>
                                    <input type="number" id="velocity-max-diameter" value="800" step="50">
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <button class="btn" onclick="calculateSizing('velocity')">Size Duct</button>
                        <button class="btn btn-secondary" onclick="clearVelocityForm()">Clear</button>
                    </div>
                </div>

                <div id="pressure-tab" class="tab-content">
                    <div class="form-group">
                        <div class="form-row">
                            <div>
                                <label>Duct Shape</label>
                                <select id="pressure-shape" onchange="toggleShapeInputs('pressure')">
                                    <option value="rectangular">Rectangular</option>
                                    <option value="circular">Circular</option>
                                </select>
                            </div>
                            <div>
                                <label>Air Flow Rate (L/s)</label>
                                <input type="number" id="pressure-flow" value="500" step="0.1">
                            </div>
                        </div>
                    </div>

                    <div class="constraint-group">
                        <div class="constraint-title">Pressure Drop Constraints</div>
                        <div class="form-row">
                            <div>
                                <label>Max Pressure Drop (Pa/m)</label>
                                <input type="number" id="pressure-max" value="0.8" step="0.1">
                            </div>
                            <div>
                                <label>Preferred Pressure Drop (Pa/m)</label>
                                <input type="number" id="pressure-preferred" value="0.5" step="0.1">
                            </div>
                        </div>
                    </div>

                    <div id="pressure-rectangular-constraints">
                        <div class="constraint-group">
                            <div class="constraint-title">Size Constraints (Rectangular)</div>
                            <div class="form-row">
                                <div>
                                    <label>Min Width (mm)</label>
                                    <input type="number" id="pressure-min-width" value="250" step="50">
                                </div>
                                <div>
                                    <label>Max Width (mm)</label>
                                    <input type="number" id="pressure-max-width" value="1000" step="50">
                                </div>
                            </div>
                            <div class="form-row">
                                <div>
                                    <label>Min Height (mm)</label>
                                    <input type="number" id="pressure-min-height" value="250" step="50">
                                </div>
                                <div>
                                    <label>Max Height (mm)</label>
                                    <input type="number" id="pressure-max-height" value="800" step="50">
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="pressure-circular-constraints" style="display: none;">
                        <div class="constraint-group">
                            <div class="constraint-title">Size Constraints (Circular)</div>
                            <div class="form-row">
                                <div>
                                    <label>Min Diameter (mm)</label>
                                    <input type="number" id="pressure-min-diameter" value="100" step="50">
                                </div>
                                <div>
                                    <label>Max Diameter (mm)</label>
                                    <input type="number" id="pressure-max-diameter" value="800" step="50">
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <button class="btn" onclick="calculateSizing('pressure')">Size Duct</button>
                        <button class="btn btn-secondary" onclick="clearPressureForm()">Clear</button>
                    </div>
                </div>

                <div id="combined-tab" class="tab-content">
                    <div class="form-group">
                        <div class="form-row">
                            <div>
                                <label>Duct Shape</label>
                                <select id="combined-shape" onchange="toggleShapeInputs('combined')">
                                    <option value="rectangular">Rectangular</option>
                                    <option value="circular">Circular</option>
                                </select>
                            </div>
                            <div>
                                <label>Air Flow Rate (L/s)</label>
                                <input type="number" id="combined-flow" value="500" step="0.1">
                            </div>
                        </div>
                    </div>

                    <div class="constraint-group">
                        <div class="constraint-title">Sizing Method</div>
                        <div class="form-row single">
                            <div>
                                <label>Constraint Method</label>
                                <select id="combined-method">
                                    <option value="velocity">Velocity Constraint Only</option>
                                    <option value="pressure">Pressure Drop Constraint Only</option>
                                    <option value="both-restrictive" selected>Most Restrictive (Larger Duct)</option>
                                    <option value="both-efficient">Most Efficient (Smaller Duct)</option>
                                </select>
                            </div>
                        </div>
                        <div class="sizing-method-info">
                            <strong>Most Restrictive:</strong> Satisfies both constraints (may result in a larger duct).<br>
                            <strong>Most Efficient:</strong> Satisfies at least one constraint (may result in a smaller duct).
                        </div>
                    </div>

                    <div class="constraint-group">
                        <div class="constraint-title">Velocity & Pressure Constraints</div>
                        <div class="form-row">
                            <div>
                                <label>Max Velocity (m/s)</label>
                                <input type="number" id="combined-velocity-max" value="6" step="0.1">
                            </div>
                            <div>
                                <label>Max Pressure Drop (Pa/m)</label>
                                <input type="number" id="combined-pressure-max" value="1.0" step="0.1">
                            </div>
                        </div>
                    </div>

                    <div id="combined-rectangular-constraints">
                        <div class="constraint-group">
                            <div class="constraint-title">Size Constraints (Rectangular)</div>
                            <div class="form-row">
                                <div>
                                    <label>Min Width (mm)</label>
                                    <input type="number" id="combined-min-width" value="250" step="50">
                                </div>
                                <div>
                                    <label>Max Width (mm)</label>
                                    <input type="number" id="combined-max-width" value="1000" step="50">
                                </div>
                            </div>
                            <div class="form-row">
                                <div>
                                    <label>Min Height (mm)</label>
                                    <input type="number" id="combined-min-height" value="250" step="50">
                                </div>
                                <div>
                                    <label>Max Height (mm)</label>
                                    <input type="number" id="combined-max-height" value="800" step="50">
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="combined-circular-constraints" style="display: none;">
                        <div class="constraint-group">
                            <div class="constraint-title">Size Constraints (Circular)</div>
                            <div class="form-row">
                                <div>
                                    <label>Min Diameter (mm)</label>
                                    <input type="number" id="combined-min-diameter" value="100" step="50">
                                </div>
                                <div>
                                    <label>Max Diameter (mm)</label>
                                    <input type="number" id="combined-max-diameter" value="800" step="50">
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <button class="btn" onclick="calculateSizing('combined')">Size Duct</button>
                        <button class="btn btn-secondary" onclick="clearCombinedForm()">Clear</button>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-title">
                    <span>📈 Results & Analysis</span>
                </div>
                <div class="toggle-switch">
                    <label class="switch">
                        <input type="checkbox" id="colorCodeToggle">
                        <span class="slider"></span>
                    </label>
                    <span class="toggle-label">Enable color coding based on industry standards</span>
                </div>
                <div id="results-container">
                    <div class="empty-state">
                        <div class="empty-state-icon">🔧</div>
                        <p>Enter parameters and calculate to see detailed results</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-title">
                <span>📜 Calculation History</span>
                <button class="btn btn-sm btn-danger" onclick="clearHistory()">Clear History</button>
            </div>
            <div id="history-container">
                 <div class="empty-state">
                    <p>Your calculation history will appear here.</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- Global State ---
        let calculationHistory = [];
        let currentTab = 'single';

        // --- Event Listeners & Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            loadHistory();
            renderHistory();
        });


        // --- UI & State Management ---

        function setTheme(theme) {
            document.body.setAttribute('data-theme', theme);
            document.querySelectorAll('.theme-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector(`.theme-${theme}`).classList.add('active');
        }

        function displayResults(results) {
            const container = document.getElementById('results-container');
            if (!results) {
                container.innerHTML = `<div class="empty-state"><div class="empty-state-icon">❌</div><p>No solution found. Please adjust your constraints and try again.</p></div>`;
                return;
            }
            
            // Define industry standards for color coding
            const standards = {
                velocity: {
                    optimal: 5,    // m/s - typically 3-5 m/s is considered optimal for main ducts
                    warning: 7.5,  // m/s - 5-7.5 m/s is acceptable but may have noise concerns
                    critical: 10   // m/s - above 10 m/s is generally too high (noise, erosion)
                },
                pressureDrop: {
                    optimal: 0.8,  // Pa/m - typically <0.8 Pa/m is considered good practice
                    warning: 1.2,  // Pa/m - 0.8-1.2 Pa/m is acceptable
                    critical: 1.5  // Pa/m - above 1.5 Pa/m is generally too high (energy concerns)
                },
                aspectRatio: {
                    optimal: 3,    // Best practice is typically <3:1
                    warning: 4,    // Up to 4:1 is acceptable
                    critical: 8    // Above 8:1 is generally problematic
                }
            };
            
            // Function to determine status class based on value and thresholds
            function getStatusClass(value, type) {
                const threshold = standards[type];
                if (!threshold) return '';
                
                if (value <= threshold.optimal) return 'status-optimal';
                if (value <= threshold.warning) return 'status-warning';
                return 'status-critical';
            }
            
            const isColorCodingEnabled = document.getElementById('colorCodeToggle').checked;
            
            container.innerHTML = '';
            let resultsHTML = '<div class="results-grid">';
            
            const resultItems = [
                { 
                    label: 'Purposed Dimensions', 
                    value: results.dimensions, 
                    unit: '',
                    statusType: null // No color coding for dimensions
                },
                { 
                    label: 'Velocity', 
                    value: results.velocity.toFixed(2), 
                    unit: 'm/s',
                    statusType: 'velocity'
                },
                { 
                    label: 'Pressure Drop', 
                    value: results.pressureDrop.toFixed(2), 
                    unit: 'Pa/m',
                    statusType: 'pressureDrop'
                },
                { 
                    label: 'Aspect Ratio', 
                    value: results.aspectRatio.toFixed(2), 
                    unit: 'AR Best Practice: ≤ 4:1',
                    statusType: 'aspectRatio'
                },
                { 
                    label: 'Equiv. Diameter', 
                    value: (results.equivalentDiameter * 1000).toFixed(0), 
                    unit: 'mm',
                    statusType: null // No color coding for equivalent diameter
                },
            ];

            if(results.sizingMethod) {
                resultItems.push({ 
                    label: 'Sizing Method', 
                    value: results.sizingMethod, 
                    unit: '',
                    statusType: null // No color coding for sizing method
                });
            }

            resultItems.forEach(item => {
                let statusClass = '';
                if (isColorCodingEnabled && item.statusType) {
                    statusClass = getStatusClass(parseFloat(item.value), item.statusType);
                }
                
                resultsHTML += `<div class="result-card ${statusClass}">
                    <div class="result-label">${item.label}</div>
                    <div class="result-value">${item.value}</div>
                    <div class="result-unit">${item.unit}</div>
                </div>`;
            });
            
            resultsHTML += '</div>';
            container.innerHTML = resultsHTML;
        }

        function switchTab(tab) {
            currentTab = tab;
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            const tabIndex = ['single', 'velocity', 'pressure', 'combined'].indexOf(tab);
            document.querySelector(`.tab:nth-child(${tabIndex + 1})`).classList.add('active');

            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById(`${tab}-tab`).classList.add('active');
        }

        function toggleShapeInputs(prefix) {
            const shape = document.getElementById(`${prefix}-shape`).value;
            const isRect = shape === 'rectangular';

            // This condition seems to be targeting elements that don't exist in the 'single' tab context.
            // Let's ensure these elements exist before trying to modify their style.
            const rectangularInputs = document.getElementById(`${prefix}-rectangular-inputs`);
            const circularInputs = document.getElementById(`${prefix}-circular-inputs`);
            if (rectangularInputs) rectangularInputs.style.display = isRect ? 'block' : 'none';
            if (circularInputs) circularInputs.style.display = isRect ? 'none' : 'block';

            if (prefix !== 'single') {
                const rectangularConstraints = document.getElementById(`${prefix}-rectangular-constraints`);
                const circularConstraints = document.getElementById(`${prefix}-circular-constraints`);
                if (rectangularConstraints) rectangularConstraints.style.display = isRect ? 'block' : 'none';
                if (circularConstraints) circularConstraints.style.display = isRect ? 'none' : 'block';
            }
        }


        function showStatus(message, type = 'success') {
            const statusEl = document.getElementById('statusMessage');
            statusEl.textContent = message;
            statusEl.className = `status-message status-${type} show`;
            setTimeout(() => statusEl.classList.remove('show'), 3000);
        }

        // --- Form Clearing Functions ---

        function clearSingleForm() {
            document.getElementById('single-flow').value = '500';
            document.getElementById('single-width').value = '300';
            document.getElementById('single-height').value = '200';
            document.getElementById('single-diameter').value = '250';
            showStatus('Form cleared');
        }

        function clearVelocityForm() {
            document.getElementById('velocity-flow').value = '500';
            document.getElementById('velocity-max').value = '6';
            document.getElementById('velocity-preferred').value = '4';
            showStatus('Form cleared');
        }

        function clearPressureForm() {
            document.getElementById('pressure-flow').value = '500';
            document.getElementById('pressure-max').value = '1.0';
            document.getElementById('pressure-preferred').value = '0.8';
            showStatus('Form cleared');
        }

        function clearCombinedForm() {
            document.getElementById('combined-flow').value = '500';
            document.getElementById('combined-velocity-max').value = '6';
            document.getElementById('combined-pressure-max').value = '1.0';
            showStatus('Form cleared');
        }

        // --- Core Calculation Engine ---

        function calculateDuctProperties({ flowM3s, shape, widthM, heightM, diameterM }) {
            const DENSITY = 1.2;
            const VISCOSITY = 1.8e-5;
            const ROUGHNESS = 0.00015; // Roughness for galvanized steel

            let area = 0, hydraulicDiameter = 0, aspectRatio = 1;

            if (shape === 'rectangular' && widthM > 0 && heightM > 0) {
                area = widthM * heightM;
                hydraulicDiameter = (2 * widthM * heightM) / (widthM + heightM);
                aspectRatio = Math.max(widthM, heightM) / Math.min(widthM, heightM);
            } else if (shape === 'circular' && diameterM > 0) {
                area = Math.PI * Math.pow(diameterM / 2, 2);
                hydraulicDiameter = diameterM;
            }

            if (area === 0) return null;

            const velocity = flowM3s / area;
            const reynolds = (DENSITY * velocity * hydraulicDiameter) / VISCOSITY;

            // Using the Haaland equation for friction factor - more stable than Colebrook-White
            let frictionFactor;
            if (reynolds > 0) {
                 frictionFactor = Math.pow(-1.8 * Math.log10(Math.pow((ROUGHNESS / hydraulicDiameter) / 3.7, 1.11) + (6.9 / reynolds)), -2);
            } else {
                frictionFactor = 0;
            }

            const pressureDrop = frictionFactor * (DENSITY / 2) * (Math.pow(velocity, 2) / hydraulicDiameter);

            // Using the equivalent diameter formula for rectangular ducts
            const equivalentDiameter = shape === 'rectangular' ? 1.30 * Math.pow( (widthM * heightM), 0.625) / Math.pow(widthM + heightM, 0.25) : diameterM;

            return {
                shape,
                dimensions: shape === 'rectangular'
                    ? `${Math.round(widthM * 1000)} mm × ${Math.round(heightM * 1000)} mm`
                    : `${Math.round(diameterM * 1000)} mm diameter`,
                velocity, pressureDrop, aspectRatio, equivalentDiameter
            };
        }


        // --- Main Calculation Triggers ---

        function getInputs(prefix) {
            const shape = document.getElementById(`${prefix}-shape`).value;
            const inputs = {
                mode: prefix,
                shape: shape,
                flow: parseFloat(document.getElementById(`${prefix}-flow`).value),
            };

            if (prefix === 'single') {
                if (shape === 'rectangular') {
                    inputs.width = parseFloat(document.getElementById('single-width').value);
                    inputs.height = parseFloat(document.getElementById('single-height').value);
                } else {
                    inputs.diameter = parseFloat(document.getElementById('single-diameter').value);
                }
            }
            return inputs;
        }


        function calculateSingle() {
            try {
                const inputs = getInputs('single');
                if (isNaN(inputs.flow) || inputs.flow <= 0) {
                    showStatus('Please enter a valid flow rate', 'error');
                    return;
                }

                const params = { flowM3s: inputs.flow / 1000, shape: inputs.shape };
                if (inputs.shape === 'rectangular') {
                    if(isNaN(inputs.width) || isNaN(inputs.height) || inputs.width <= 0 || inputs.height <= 0){
                        showStatus('Please enter valid width and height', 'error');
                        return;
                    }
                    params.widthM = inputs.width / 1000;
                    params.heightM = inputs.height / 1000;
                } else {
                     if(isNaN(inputs.diameter) || inputs.diameter <= 0){
                        showStatus('Please enter a valid diameter', 'error');
                        return;
                    }
                    params.diameterM = inputs.diameter / 1000;
                }

                const results = calculateDuctProperties(params);
                if (results) {
                    displayResults(results);
                    updateHistory({ inputs: inputs, results: results });
                    showStatus('Calculation complete');
                } else {
                    showStatus('Invalid dimensions provided', 'error');
                }
            } catch (e) {
                console.error(e);
                showStatus('An error occurred during calculation.', 'error');
            }
        }

        function calculateSizing(mode) {
             try {
                const shape = document.getElementById(`${mode}-shape`).value;
                const flow = parseFloat(document.getElementById(`${mode}-flow`).value);
                const flowM3s = flow / 1000;
                const maxAspectRatio = parseFloat(document.getElementById('global-aspect-ratio').value);
                const stepM = parseFloat(document.getElementById('global-step-size').value) / 1000;

                const constraints = {
                    velocity: mode !== 'pressure' ? parseFloat(document.getElementById(`${mode}-${mode === 'velocity' ? 'max' : 'velocity-max'}`).value) : Infinity,
                    pressure: mode !== 'velocity' ? parseFloat(document.getElementById(`${mode}-${mode === 'pressure' ? 'max' : 'pressure-max'}`).value) : Infinity,
                    method: mode === 'combined' ? document.getElementById('combined-method').value : mode,
                };

                if (isNaN(flow) || flow <= 0 || isNaN(constraints.velocity) || isNaN(constraints.pressure) || isNaN(maxAspectRatio) || isNaN(stepM)) {
                    showStatus('Please enter valid numeric inputs for flow and constraints', 'error');
                    return;
                }

                let bestOption = null;

                if (shape === 'rectangular') {
                    const minW = parseFloat(document.getElementById(`${mode}-min-width`).value) / 1000;
                    const maxW = parseFloat(document.getElementById(`${mode}-max-width`).value) / 1000;
                    const minH = parseFloat(document.getElementById(`${mode}-min-height`).value) / 1000;
                    const maxH = parseFloat(document.getElementById(`${mode}-max-height`).value) / 1000;
                    let solutions = [];

                    for (let w = minW; w <= maxW; w += stepM) {
                        for (let h = minH; h <= maxH; h += stepM) {
                            const props = calculateDuctProperties({ flowM3s, shape, widthM: w, heightM: h });
                            if (props && props.aspectRatio <= maxAspectRatio && isSizeValid(props, constraints)) {
                                solutions.push(props);
                            }
                        }
                    }
                    if (solutions.length > 0) {
                        solutions.sort((a, b) => {
                            const areaA = a.equivalentDiameter; // Use equivalent diameter for a combined size metric
                            const areaB = b.equivalentDiameter;
                            if (Math.abs(areaA - areaB) > 0.001) return areaA - areaB;
                            return a.aspectRatio - b.aspectRatio; // Then prefer lower aspect ratio
                        });
                        bestOption = solutions[0];
                    }

                } else { // Circular
                    const minD = parseFloat(document.getElementById(`${mode}-min-diameter`).value) / 1000;
                    const maxD = parseFloat(document.getElementById(`${mode}-max-diameter`).value) / 1000;
                    for (let d = minD; d <= maxD; d += stepM) {
                        const props = calculateDuctProperties({ flowM3s, shape, diameterM: d });
                        if (isSizeValid(props, constraints)) {
                            bestOption = props;
                            break; // First valid size is the smallest
                        }
                    }
                }

                if (bestOption) {
                    bestOption.sizingMethod = getSizingMethodLabel(bestOption, constraints);
                    displayResults(bestOption);
                    const inputs = { mode, shape, flow, constraints, maxAspectRatio, step: stepM * 1000 };
                    updateHistory({ inputs, results: bestOption });
                    showStatus('Duct sizing complete');
                } else {
                    displayResults(null);
                    showStatus('No solution found with the given constraints.', 'error');
                }
            } catch (e) {
                console.error(e);
                showStatus('An error occurred during sizing.', 'error');
            }
        }

        function isSizeValid(props, constraints) {
            if (!props) return false;
            const meetsVelocity = props.velocity <= constraints.velocity;
            const meetsPressure = props.pressureDrop <= constraints.pressure;
            switch (constraints.method) {
                case 'velocity': return meetsVelocity;
                case 'pressure': return meetsPressure;
                case 'both-restrictive': return meetsVelocity && meetsPressure;
                case 'both-efficient': return meetsVelocity || meetsPressure;
                default: return false;
            }
        }

        function getSizingMethodLabel(props, constraints) {
            if (!props || !constraints.method) return 'N/A';
            switch(constraints.method) {
                case 'velocity': return 'Velocity Constraint';
                case 'pressure': return 'Pressure Drop Constraint';
                case 'both-restrictive': return 'Combined (Restrictive)';
                case 'both-efficient':
                    const velRatio = props.velocity / constraints.velocity;
                    const presRatio = props.pressureDrop / constraints.pressure;
                    if (!isFinite(velRatio) && isFinite(presRatio)) return 'Combined (Efficient - Pressure Driven)';
                    if (isFinite(velRatio) && !isFinite(presRatio)) return 'Combined (Efficient - Velocity Driven)';
                    return velRatio > presRatio ? 'Combined (Efficient - Velocity Driven)' : 'Combined (Efficient - Pressure Driven)';
                default: return 'N/A';
            }
        }


        // --- Results & History Display ---

function displayResults(results) {
    const container = document.getElementById('results-container');
    if (!results) {
        container.innerHTML = `<div class="empty-state"><div class="empty-state-icon">❌</div><p>No solution found. Please adjust your constraints and try again.</p></div>`;
        return;
    }
    
    // Define industry standards for color coding
    const standards = {
        velocity: {
            optimal: 5,    // m/s - typically 3-5 m/s is considered optimal for main ducts
            warning: 7.5,  // m/s - 5-7.5 m/s is acceptable but may have noise concerns
            critical: 10   // m/s - above 10 m/s is generally too high (noise, erosion)
        },
        pressureDrop: {
            optimal: 0.8,  // Pa/m - typically <0.8 Pa/m is considered good practice
            warning: 1.2,  // Pa/m - 0.8-1.2 Pa/m is acceptable
            critical: 1.5  // Pa/m - above 1.5 Pa/m is generally too high (energy concerns)
        },
        aspectRatio: {
            optimal: 3,    // Best practice is typically <3:1
            warning: 4,    // Up to 4:1 is acceptable
            critical: 8    // Above 8:1 is generally problematic
        }
    };
    
    // Function to determine status class based on value and thresholds
    function getStatusClass(value, type) {
        const threshold = standards[type];
        if (!threshold) return '';
        
        if (value <= threshold.optimal) return 'status-optimal';
        if (value <= threshold.warning) return 'status-warning';
        return 'status-critical';
    }
    
    const isColorCodingEnabled = document.getElementById('colorCodeToggle').checked;
    container.innerHTML = '';
    let resultsHTML = '<div class="results-grid">';
    const resultItems = [
        { 
            label: 'Purposed Dimensions', 
            value: results.dimensions, 
            unit: '',
            statusType: null // No color coding for dimensions
        },
        { 
            label: 'Velocity', 
            value: results.velocity.toFixed(2), 
            unit: 'm/s',
            statusType: 'velocity'
        },
        { 
            label: 'Pressure Drop', 
            value: results.pressureDrop.toFixed(2), 
            unit: 'Pa/m',
            statusType: 'pressureDrop'
        },
        { 
            label: 'Aspect Ratio', 
            value: results.aspectRatio.toFixed(2), 
            unit: 'AR Best Practice: ≤ 4:1',
            statusType: 'aspectRatio'
        },
        { 
            label: 'Equiv. Diameter', 
            value: (results.equivalentDiameter * 1000).toFixed(0), 
            unit: 'mm',
            statusType: null // No color coding for equivalent diameter
        },
    ];

    if(results.sizingMethod) {
        resultItems.push({ 
            label: 'Sizing Method', 
            value: results.sizingMethod, 
            unit: '',
            statusType: null // No color coding for sizing method
        });
    }

    resultItems.forEach(item => {
        let statusClass = '';
        if (isColorCodingEnabled && item.statusType) {
            statusClass = getStatusClass(parseFloat(item.value), item.statusType);
        }
        
        resultsHTML += `<div class="result-card ${statusClass}">
            <div class="result-label">${item.label}</div>
            <div class="result-value">${item.value}</div>
            <div class="result-unit">${item.unit}</div>
        </div>`;
    });
    
    resultsHTML += '</div>';
    container.innerHTML = resultsHTML;
}

        function renderHistory() {
            const container = document.getElementById('history-container');
            container.innerHTML = '';
            if (calculationHistory.length === 0) {
                container.innerHTML = `<div class="empty-state"><p>Your calculation history will appear here.</p></div>`;
                return;
            }

            calculationHistory.slice().reverse().forEach(item => { // Render oldest first
                const date = new Date(item.timestamp);
                const timeString = date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                const historyItemHTML = `
                    <div class="history-item">
                        <div>
                            <div class="history-details">
                                <span class="history-detail"><strong>Dim:</strong> ${item.results.dimensions}</span>
                                <span class="history-detail"><strong>Vel:</strong> ${item.results.velocity.toFixed(2)} m/s</span>
                                <span class="history-detail"><strong>PD:</strong> ${item.results.pressureDrop.toFixed(2)} Pa/m</span>
                            </div>
                            <div class="history-timestamp">${date.toLocaleDateString()} ${timeString} (${item.inputs.mode})</div>
                        </div>
                        <button class="btn btn-sm btn-secondary" onclick="restoreFromHistory('${item.timestamp}')">Restore</button>
                    </div>
                `;
                container.insertAdjacentHTML('afterbegin', historyItemHTML); // Add new items to the top
            });
        }

        // --- History Management ---

        function loadHistory() {
            try {
                const savedHistory = localStorage.getItem('ductCalcHistory');
                if (savedHistory) {
                    calculationHistory = JSON.parse(savedHistory);
                }
            } catch (e) {
                console.error("Could not load history:", e);
                calculationHistory = [];
            }
        }

        function updateHistory(entry) {
            entry.timestamp = new Date().toISOString();
            calculationHistory.push(entry); // Add to the end
            if (calculationHistory.length > 10) {
                calculationHistory.shift(); // Remove the oldest
            }
            try {
                localStorage.setItem('ductCalcHistory', JSON.stringify(calculationHistory));
            } catch (e) {
                console.error("Could not save history:", e);
            }
            renderHistory();
        }

        function clearHistory() {
            calculationHistory = [];
            localStorage.removeItem('ductCalcHistory');
            renderHistory();
            showStatus('History cleared');
        }

        function restoreFromHistory(timestamp) {
            const historyItem = calculationHistory.find(item => item.timestamp === timestamp);
            if (!historyItem) {
                showStatus('Could not find history item.', 'error');
                return;
            }

            const { inputs } = historyItem;
            const prefix = inputs.mode;

            switchTab(prefix);

            if (prefix !== 'single') {
                document.getElementById('global-aspect-ratio').value = inputs.maxAspectRatio || 1.5;
                document.getElementById('global-step-size').value = inputs.step || 50;
            }

            document.getElementById(`${prefix}-shape`).value = inputs.shape;
            document.getElementById(`${prefix}-flow`).value = inputs.flow;

            if (prefix === 'single') {
                 if (inputs.shape === 'rectangular') {
                    document.getElementById('single-width').value = inputs.width;
                    document.getElementById('single-height').value = inputs.height;
                } else {
                    document.getElementById('single-diameter').value = inputs.diameter;
                }
            }

            if (inputs.constraints) {
                const velMaxId = `${prefix}-${prefix === 'velocity' ? 'max' : 'velocity-max'}`;
                const presMaxId = `${prefix}-${prefix === 'pressure' ? 'max' : 'pressure-max'}`;

                if(inputs.constraints.velocity !== Infinity) {
                    document.getElementById(velMaxId).value = inputs.constraints.velocity;
                }
                if(inputs.constraints.pressure !== Infinity) {
                    document.getElementById(presMaxId).value = inputs.constraints.pressure;
                }
                if(prefix === 'combined') {
                    document.getElementById('combined-method').value = inputs.constraints.method;
                }
            }

            toggleShapeInputs(prefix);
            displayResults(historyItem.results);
            showStatus('Inputs restored from history.');
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

    </script>
</body>
</html>